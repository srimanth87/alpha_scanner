<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NDX100 â€” Trading Scanner Suite</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Base â”€â”€ */
:root{
  --bg:#04070a;--card:#070d12;--border:#0d1f2d;
  --green:#00ff88;--red:#ff3355;--yellow:#ffd700;
  --accent:#00d4ff;--purple:#c084fc;--orange:#fb923c;
  --dim:#3a5a6a;--text:#ddeeff;--muted:#1a3040;
  --mono:'JetBrains Mono',monospace;
  /* swing palette */
  --sg:#00e5a0;--sr:#ff3d6b;--sy:#fbbf24;--sp:#c084fc;--sb:#38bdf8;
  --sdim:#334d65;--sbright:#c8ddef;
  --surf:#0c1018;--surf2:#111722;--surf3:#161e2e;--bord2:#223040;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:var(--mono);min-height:100vh}
.gridbg{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.15;
  background-image:linear-gradient(rgba(0,212,255,.22) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,212,255,.22) 1px,transparent 1px);background-size:40px 40px}
.wrap{max-width:1420px;margin:0 auto;padding:20px;position:relative;z-index:1}

/* â”€â”€ Tabs â”€â”€ */
.tabs{display:flex;border-bottom:2px solid var(--border);margin-bottom:0}
.tab-btn{font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:.12em;
  padding:13px 30px;border:none;background:transparent;color:var(--dim);
  cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all .2s}
.tab-btn:hover{color:var(--text)}
.td{color:var(--accent);border-bottom-color:var(--accent) !important}
.ts{color:var(--red);border-bottom-color:var(--red) !important}
.tw{color:var(--sg);border-bottom-color:var(--sg) !important}
.tab-panel{display:none;padding-top:22px}
.tab-panel.active{display:block}

/* â”€â”€ Headers â”€â”€ */
.hdr{display:flex;justify-content:space-between;align-items:flex-end;
  border-bottom:1px solid var(--border);padding-bottom:16px;margin-bottom:18px}
.sub{font-size:9px;color:var(--dim);letter-spacing:.2em;margin-top:5px;text-transform:uppercase}
.hdr-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px}
.title-d{font-family:'Bebas Neue',sans-serif;font-size:44px;line-height:1;letter-spacing:.05em;
  background:linear-gradient(135deg,var(--accent),var(--green));-webkit-background-clip:text;background-clip:text;color:transparent}
.title-s{font-family:'Bebas Neue',sans-serif;font-size:44px;line-height:1;letter-spacing:.05em;
  background:linear-gradient(135deg,var(--red),var(--orange));-webkit-background-clip:text;background-clip:text;color:transparent}
.title-w{font-family:'Bebas Neue',sans-serif;font-size:44px;line-height:1;letter-spacing:.04em;
  color:var(--sg);text-shadow:0 0 40px rgba(0,229,160,.2)}

/* â”€â”€ Buttons â”€â”€ */
.btn-d{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:.12em;
  background:var(--green);color:#000;border:none;padding:12px 32px;cursor:pointer;transition:all .2s;box-shadow:0 0 24px rgba(0,255,136,.25)}
.btn-d:hover{background:#00ffaa}.btn-d:disabled{background:var(--muted);color:var(--dim);cursor:not-allowed;box-shadow:none}
.btn-s{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:.12em;
  background:var(--red);color:#fff;border:none;padding:12px 32px;cursor:pointer;transition:all .2s;box-shadow:0 0 24px rgba(255,51,85,.25)}
.btn-s:hover{background:#ff5577}.btn-s:disabled{background:var(--muted);color:var(--dim);cursor:not-allowed;box-shadow:none}
.btn-w{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:.12em;
  background:var(--sg);color:#001a0d;border:none;padding:14px 36px;border-radius:4px;cursor:pointer;transition:all .2s;box-shadow:0 0 30px rgba(0,229,160,.2)}
.btn-w:hover{background:#00ffb3}.btn-w:disabled{background:var(--surf3);color:var(--sdim);cursor:not-allowed;box-shadow:none}

/* â”€â”€ Market status â”€â”€ */
.mstat{display:flex;align-items:center;gap:7px;font-size:10px}
.mdot{width:7px;height:7px;border-radius:50%;animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.25}}

/* â”€â”€ Legend / criteria â”€â”€ */
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.leg{display:flex;align-items:center;gap:6px;background:var(--card);border:1px solid var(--border);padding:5px 11px;border-radius:2px;font-size:10px;color:var(--dim)}
.ldot{width:6px;height:6px;border-radius:50%}
.criteria{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.crit{display:flex;align-items:center;gap:6px;background:var(--surf2);border:1px solid var(--border);padding:5px 12px;border-radius:3px;font-size:10px;color:var(--text);letter-spacing:.05em}
.cdot{width:7px;height:7px;border-radius:50%;flex-shrink:0}

/* â”€â”€ Regime â”€â”€ */
.regime{display:flex;gap:2px;margin-bottom:16px}
.reg-card{flex:1;background:var(--card);border:1px solid var(--border);padding:12px 16px;display:flex;align-items:center;gap:10px;font-size:11px}
.reg-icon{font-size:18px}.reg-val{font-size:13px;font-weight:700}
.reg-lbl{font-size:9px;color:var(--dim);letter-spacing:.1em;text-transform:uppercase}

/* â”€â”€ Warn â”€â”€ */
.warn{background:rgba(255,51,85,.08);border:1px solid rgba(255,51,85,.25);padding:10px 16px;margin-bottom:16px;font-size:10px;color:var(--red)}

/* â”€â”€ Progress â”€â”€ */
.prog-wrap{margin-bottom:12px;display:none}.prog-wrap.on{display:block}
.prog-lbl{font-size:9px;color:var(--dim);letter-spacing:.08em;margin-bottom:5px;display:flex;justify-content:space-between}
.prog-bg{height:2px;background:var(--muted);border-radius:2px;overflow:hidden}
.pfd{height:100%;background:linear-gradient(90deg,var(--accent),var(--green));border-radius:2px;transition:width .3s}
.pfs{height:100%;background:linear-gradient(90deg,var(--red),var(--orange));border-radius:2px;transition:width .3s}
.pfw{height:100%;background:linear-gradient(90deg,#00b37a,#00e5a0);border-radius:2px;transition:width .3s}

/* â”€â”€ Log â”€â”€ */
.log{background:var(--card);border:1px solid var(--border);padding:10px 14px;max-height:110px;overflow:auto;font-size:10px;line-height:1.9;margin-bottom:14px;display:none}
.log.on{display:block}
.lok{color:var(--green)}.lerr{color:var(--red)}.linfo{color:var(--accent)}.lwarn{color:var(--yellow)}

/* â”€â”€ Stats bar â”€â”€ */
.stats{display:grid;grid-template-columns:repeat(6,1fr);gap:1px;background:var(--border);margin-bottom:16px}
.stat{background:var(--card);padding:14px 10px;text-align:center}
.snum{font-family:'Bebas Neue',sans-serif;font-size:32px;line-height:1;color:var(--text)}
.snum.g{color:var(--green)}.snum.sg{color:var(--sg)}.snum.r{color:var(--red)}
.snum.y{color:var(--yellow)}.snum.a{color:var(--accent)}.snum.o{color:var(--orange)}.snum.p{color:var(--purple)}
.slbl{font-size:8px;color:var(--dim);letter-spacing:.15em;text-transform:uppercase;margin-top:4px}

/* â”€â”€ Tag styles (shared) â”€â”€ */
.tag{font-size:8px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:600}
.tg{background:rgba(0,255,136,.1);color:var(--green);border:1px solid rgba(0,255,136,.2)}
.ty{background:rgba(255,215,0,.1);color:var(--yellow);border:1px solid rgba(255,215,0,.2)}
.tp{background:rgba(192,132,252,.1);color:var(--purple);border:1px solid rgba(192,132,252,.2)}
.ta{background:rgba(0,212,255,.1);color:var(--accent);border:1px solid rgba(0,212,255,.2)}
.tr{background:rgba(255,51,85,.1);color:var(--red);border:1px solid rgba(255,51,85,.2)}
.to{background:rgba(251,146,60,.1);color:var(--orange);border:1px solid rgba(251,146,60,.2)}
/* swing tags */
.stg{background:rgba(0,229,160,.1);color:var(--sg);border:1px solid rgba(0,229,160,.2);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:500}
.sty{background:rgba(251,191,36,.1);color:var(--sy);border:1px solid rgba(251,191,36,.2);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:500}
.stp{background:rgba(192,132,252,.1);color:var(--sp);border:1px solid rgba(192,132,252,.2);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:500}
.stb{background:rgba(56,189,248,.1);color:var(--sb);border:1px solid rgba(56,189,248,.2);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:500}
.str{background:rgba(255,61,107,.1);color:var(--sr);border:1px solid rgba(255,61,107,.2);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:500}

/* â”€â”€ Day/Scalp grid tables â”€â”€ */
.tbl-outer{background:var(--card);border:1px solid var(--border);overflow:hidden}
.day-head,.day-row{display:grid;grid-template-columns:50px 90px 185px 105px 75px 82px 90px 85px 90px 82px 75px;border-bottom:1px solid var(--border)}
.day-head{background:rgba(0,212,255,.04)}
.scalp-head,.scalp-row{display:grid;grid-template-columns:46px 90px 165px 100px 72px 80px 80px 82px 115px 72px 72px;border-bottom:1px solid var(--border)}
.scalp-head{background:rgba(255,51,85,.04)}
.day-head>div,.scalp-head>div{padding:9px 10px;font-size:9px;color:var(--dim);letter-spacing:.15em;text-transform:uppercase}
.day-row,.scalp-row{background:var(--card);transition:background .15s;position:relative}
.day-row:hover{background:#0a1520}.scalp-row:hover{background:#0a1015}
.day-row:last-child,.scalp-row:last-child{border-bottom:none}
.trow-anim{animation:fadein .45s ease both}
@keyframes fadein{from{opacity:0;transform:translateX(-6px)}to{opacity:1;transform:translateX(0)}}
.cell{padding:11px 10px;display:flex;align-items:center;font-size:11px;border-right:1px solid rgba(13,31,45,.7)}
.cell:last-child{border-right:none}
.cell.col{flex-direction:column;align-items:flex-start;gap:2px}
.rankbar{position:absolute;left:0;top:0;bottom:0;width:3px}
.rnum{font-family:'Bebas Neue',sans-serif;font-size:24px;line-height:1}
.rnum.gold{color:#f59e0b}.rnum.silver{color:#94a3b8}.rnum.bronze{color:#b45309}
.tsym{font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:.04em;color:var(--text)}
.tname{font-size:9px;color:var(--dim);margin-top:1px}
.sig-tags{display:flex;gap:4px;flex-wrap:wrap;margin-top:4px}
.chg{font-size:11px;font-weight:700}.chg.pos{color:var(--green)}.chg.neg{color:var(--red)}
.pval{font-size:14px;font-weight:700;color:var(--text)}
.bar-mini{width:44px;height:3px;background:var(--muted);border-radius:2px;overflow:hidden;margin-top:4px}
.bf{height:100%;border-radius:2px}
.bfg{background:var(--green)}.bfr{background:var(--red)}.bfy{background:var(--yellow)}.bfo{background:var(--orange)}
.score-num{font-family:'Bebas Neue',sans-serif;font-size:28px;line-height:1}
.score-den{font-size:9px;color:var(--dim)}
.score-bar{width:44px;height:2px;background:var(--muted);border-radius:2px;overflow:hidden;margin-top:4px}
.sfd{height:100%;background:linear-gradient(90deg,var(--accent),var(--green))}
.sfs{height:100%;background:linear-gradient(90deg,var(--red),var(--orange))}
.target-box{display:flex;flex-direction:column;gap:2px}
.te{font-size:10px;font-weight:700;color:var(--accent)}
.tt{font-size:10px;font-weight:700;color:var(--green)}
.ts2{font-size:10px;font-weight:700;color:var(--red)}
.msg{padding:50px;text-align:center;color:var(--dim);font-size:13px;letter-spacing:.05em}
.spin{display:inline-block;width:9px;height:9px;border:2px solid var(--dim);border-top-color:var(--green);border-radius:50%;animation:spin .8s linear infinite;margin-right:8px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ Swing table â”€â”€ */
.sw-wrap{background:var(--surf);border:1px solid var(--border);border-radius:4px;overflow:hidden}
.sw-wrap table{width:100%;border-collapse:collapse}
.sw-wrap thead{background:var(--surf2);border-bottom:1px solid var(--bord2)}
.sw-wrap thead th{padding:10px 12px;font-size:9px;color:var(--sdim);letter-spacing:.12em;text-transform:uppercase;white-space:nowrap;font-weight:500}
.sw-wrap thead th:nth-child(-n+3){text-align:left}.sw-wrap thead th:nth-child(n+4){text-align:right}
.sw-wrap tbody tr{border-bottom:1px solid rgba(26,37,53,.7);transition:background .15s}
.sw-wrap tbody tr:last-child{border:none}.sw-wrap tbody tr:hover{background:var(--surf2)}
.sw-wrap td{padding:11px 12px;white-space:nowrap;vertical-align:middle}
.sw-wrap td:nth-child(-n+3){text-align:left}.sw-wrap td:nth-child(n+4){text-align:right}
.data-row{animation:rowin .5s ease both}
@keyframes rowin{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
.msg-row td{padding:60px;text-align:center;color:var(--dim);font-size:13px;letter-spacing:.05em}
.rank-cell{display:flex;align-items:center}
.rank-bar{width:3px;height:44px;margin-right:12px;border-radius:2px}
.rank-num{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--dim)}
.rank-num.top3{color:#f59e0b}
.t-sym{font-size:15px;font-weight:700;color:var(--sbright);letter-spacing:.04em}
.t-name{font-size:9px;color:var(--sdim);margin-top:2px}
.signal-main{font-size:11px}.signal-main.strong{color:var(--sg)}.signal-main.watch{color:var(--sy)}
.price-val{font-size:14px;font-weight:600;color:var(--sbright);font-variant-numeric:tabular-nums}
.swchg{font-size:10px;margin-top:2px;font-variant-numeric:tabular-nums}
.swchg.pos{color:var(--sg)}.swchg.neg{color:var(--sr)}
.rsi-num{font-size:16px;font-weight:700;font-variant-numeric:tabular-nums}
.rsi-num.oversold{color:var(--sg)}.rsi-num.overbought{color:var(--sr)}.rsi-num.neutral{color:var(--sy)}
.mini-bar{width:44px;height:3px;background:var(--surf3);border-radius:2px;overflow:hidden;margin-top:4px;display:inline-block}
.mini-fill{height:100%;border-radius:2px}
.mfg{background:var(--sg)}.mfr{background:var(--sr)}.mfy{background:var(--sy)}
.mfp{background:linear-gradient(90deg,#7c3aed,#c084fc)}.mfb{background:#6366f1}.mfd{background:var(--sdim)}
.mfbull{background:linear-gradient(90deg,#007a56,var(--sg))}.mfbear{background:linear-gradient(90deg,#7a001f,var(--sr))}
.ema-val{font-size:11px;font-variant-numeric:tabular-nums}
.ema-above{color:var(--sg)}.ema-below{color:var(--sr)}
.num-bull{color:var(--sg);font-size:14px;font-weight:700}.num-bear{color:var(--sr);font-size:14px;font-weight:700}.num-dim{color:var(--sdim);font-size:14px;font-weight:700}
.sq-fire{color:var(--sp);font-size:14px;font-weight:700}.sq-warm{color:#818cf8;font-size:14px;font-weight:700}.sq-cool{color:var(--sdim);font-size:14px;font-weight:700}
.score-cell{display:flex;flex-direction:column;align-items:flex-end;gap:2px}
.sw-score-num{font-family:'Bebas Neue',sans-serif;font-size:32px;line-height:1}
.sw-score-den{font-size:9px;color:var(--sdim)}
.sw-score-bar{width:50px;height:3px;background:var(--surf3);border-radius:2px;overflow:hidden}
.sw-score-fill{height:100%;background:linear-gradient(90deg,#00b37a,#00e5a0)}

/* â”€â”€ Footer â”€â”€ */
.foot{margin-top:14px;font-size:9px;color:var(--muted);letter-spacing:.05em;display:flex;justify-content:space-between}

/* â”€â”€ Mobile â”€â”€ */
@media(max-width:768px){
  .wrap{padding:10px 8px}.title-d,.title-s,.title-w{font-size:28px}
  .hdr{flex-direction:column;gap:10px;align-items:flex-start}
  .hdr-right{width:100%;align-items:flex-start}
  .btn-d,.btn-s,.btn-w{width:100%}
  .tab-btn{font-size:13px;padding:10px 12px}
  .regime{flex-wrap:wrap}.reg-card{min-width:calc(50% - 1px)}
  .stats{grid-template-columns:repeat(3,1fr)}
  .legend,.criteria{display:none}
  .tbl-outer,.sw-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .day-head,.day-row{min-width:920px}
  .scalp-head,.scalp-row{min-width:900px}
  .sw-wrap table{min-width:900px}
  .foot{flex-direction:column;gap:4px}
}
</style>
</head>
<body>
<div class="gridbg"></div>
<div class="wrap">

<!-- â”€â”€ Tab bar â”€â”€ -->
<div class="tabs" style="justify-content:space-between;align-items:center">
  <div style="display:flex">
    <button class="tab-btn td" id="tb-d" onclick="switchTab('d')">âš¡ DAY TRADING</button>
    <button class="tab-btn"    id="tb-s" onclick="switchTab('s')">ğŸ¯ SCALP TRADING</button>
    <button class="tab-btn"    id="tb-w" onclick="switchTab('w')">ğŸ“ˆ SWING TRADING</button>
  </div>
  <label style="display:flex;align-items:center;gap:9px;padding:0 18px;cursor:pointer;font-size:10px;color:var(--dim);letter-spacing:.08em;user-select:none" onclick="toggleTG()">
    <div style="position:relative;width:38px;height:21px;flex-shrink:0">
      <div id="tgTrack" style="position:absolute;inset:0;border-radius:20px;background:var(--muted);border:1px solid var(--border);transition:background .2s,border-color .2s"></div>
      <div id="tgThumb" style="position:absolute;top:3px;left:3px;width:13px;height:13px;border-radius:50%;background:var(--dim);transition:all .2s"></div>
    </div>
    <span id="tgLabel" style="white-space:nowrap;transition:color .2s">ğŸ“² TELEGRAM ALERTS OFF</span>
  </label>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DAY TRADER TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-d" class="tab-panel active">
  <div class="hdr">
    <div><div class="title-d">NDX100 DAY TRADER</div><div class="sub">Mid-day Momentum Â· Breakout Scoring Â· Top 10 to Buy Today</div></div>
    <div class="hdr-right">
      <button class="btn-d" id="dBtn" onclick="runDay()">&#9654; SCAN NOW</button>
      <div class="mstat"><div class="mdot" id="dDot" style="background:var(--dim)"></div><span id="dStat" style="color:var(--dim)">READY</span><span id="dTime" style="color:var(--dim);margin-left:8px"></span></div>
    </div>
  </div>
  <div class="legend">
    <div class="leg"><div class="ldot" style="background:var(--green)"></div>Intraday % gain</div>
    <div class="leg"><div class="ldot" style="background:var(--yellow)"></div>Volume surge vs 20-day avg</div>
    <div class="leg"><div class="ldot" style="background:var(--accent)"></div>Relative strength vs SPY</div>
    <div class="leg"><div class="ldot" style="background:var(--purple)"></div>Price above VWAP</div>
    <div class="leg"><div class="ldot" style="background:var(--orange)"></div>Gap up held</div>
    <div class="leg"><div class="ldot" style="background:var(--red)"></div>Range expansion (ATR)</div>
  </div>
  <div class="regime">
    <div class="reg-card"><div class="reg-icon">â³</div><div><div class="reg-val" id="dSpyChg" style="color:var(--dim)">â€”</div><div class="reg-lbl">SPY Today</div></div></div>
    <div class="reg-card"><div class="reg-icon">ğŸ“Š</div><div><div class="reg-val" id="dSpyVol" style="color:var(--dim)">â€”</div><div class="reg-lbl">SPY Vol</div></div></div>
    <div class="reg-card"><div class="reg-icon">ğŸŒ¡ï¸</div><div><div class="reg-val" id="dRegime" style="color:var(--dim)">â€”</div><div class="reg-lbl">Market Regime</div></div></div>
    <div class="reg-card"><div class="reg-icon">âš¡</div><div><div class="reg-val" id="dScanT" style="color:var(--dim)">â€”</div><div class="reg-lbl">Scan Time</div></div></div>
  </div>
  <div class="prog-wrap" id="dProg"><div class="prog-lbl"><span id="dPL">Scanning...</span><span id="dPP">0%</span></div><div class="prog-bg"><div class="pfd" id="dPF" style="width:0%"></div></div></div>
  <div class="log" id="dLog"></div>
  <div class="stats">
    <div class="stat"><div class="snum" id="d1">â€”</div><div class="slbl">Scanned</div></div>
    <div class="stat"><div class="snum g" id="d2">â€”</div><div class="slbl">Gaining &gt;1%</div></div>
    <div class="stat"><div class="snum y" id="d3">â€”</div><div class="slbl">Vol Surge</div></div>
    <div class="stat"><div class="snum a" id="d4">â€”</div><div class="slbl">Beats SPY</div></div>
    <div class="stat"><div class="snum p" id="d5">â€”</div><div class="slbl">Gap Up</div></div>
    <div class="stat"><div class="snum" id="d6">â€”</div><div class="slbl">Avg Chg%</div></div>
  </div>
  <div class="tbl-outer">
    <div class="day-head"><div>#</div><div>Ticker</div><div>Signal</div><div>Price</div><div>Chg%</div><div>Vol Ratio</div><div>Rel Str</div><div>Gap%</div><div>Range/ATR</div><div>VWAP</div><div>Score</div></div>
    <div id="dBody"><div class="msg">Press SCAN NOW to load live momentum data</div></div>
  </div>
  <div class="foot"><span>Yahoo Finance Â· No API key Â· No rate limits Â· Not financial advice</span><span id="dFoot"></span></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCALP TRADER TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-s" class="tab-panel">
  <div class="hdr">
    <div><div class="title-s">NDX100 SCALP SCANNER</div><div class="sub">5-Min Momentum Â· Buy &amp; Sell Within 1 Hour Â· Top 10 Right Now</div></div>
    <div class="hdr-right">
      <button class="btn-s" id="sBtn" onclick="runScalp()">&#9654; SCAN NOW</button>
      <div class="mstat"><div class="mdot" id="sDot" style="background:var(--dim)"></div><span id="sStat" style="color:var(--dim)">READY</span><span id="sTime" style="color:var(--dim);margin-left:8px"></span></div>
    </div>
  </div>
  <div class="warn">âš¡ SCALP MODE â€” These signals are for very short trades (15â€“60 min). Always use a stop loss. Not financial advice.</div>
  <div class="legend">
    <div class="leg"><div class="ldot" style="background:var(--green)"></div>Last 3 candles bullish (5-min)</div>
    <div class="leg"><div class="ldot" style="background:var(--yellow)"></div>Volume spike on last candle</div>
    <div class="leg"><div class="ldot" style="background:var(--accent)"></div>Price above VWAP</div>
    <div class="leg"><div class="ldot" style="background:var(--orange)"></div>Momentum accelerating</div>
    <div class="leg"><div class="ldot" style="background:var(--purple)"></div>Relative strength vs SPY 5m</div>
  </div>
  <div class="regime">
    <div class="reg-card"><div class="reg-icon">ğŸ“Š</div><div><div class="reg-val" id="sSpy5m" style="color:var(--dim)">â€”</div><div class="reg-lbl">SPY 5-Min</div></div></div>
    <div class="reg-card"><div class="reg-icon">ğŸŒ¡ï¸</div><div><div class="reg-val" id="sRegime" style="color:var(--dim)">â€”</div><div class="reg-lbl">Market Now</div></div></div>
    <div class="reg-card"><div class="reg-icon">âš¡</div><div><div class="reg-val" id="sMom" style="color:var(--dim)">â€”</div><div class="reg-lbl">SPY Momentum</div></div></div>
    <div class="reg-card"><div class="reg-icon">ğŸ•</div><div><div class="reg-val" id="sScanT" style="color:var(--dim)">â€”</div><div class="reg-lbl">Scan Time</div></div></div>
  </div>
  <div class="prog-wrap" id="sProg"><div class="prog-lbl"><span id="sPL">Scanning...</span><span id="sPP">0%</span></div><div class="prog-bg"><div class="pfs" id="sPF" style="width:0%"></div></div></div>
  <div class="log" id="sLog"></div>
  <div class="stats">
    <div class="stat"><div class="snum" id="s1">â€”</div><div class="slbl">Scanned</div></div>
    <div class="stat"><div class="snum g" id="s2">â€”</div><div class="slbl">Bull Candles</div></div>
    <div class="stat"><div class="snum y" id="s3">â€”</div><div class="slbl">Vol Spike</div></div>
    <div class="stat"><div class="snum a" id="s4">â€”</div><div class="slbl">Above VWAP</div></div>
    <div class="stat"><div class="snum o" id="s5">â€”</div><div class="slbl">Accelerating</div></div>
    <div class="stat"><div class="snum r" id="s6">â€”</div><div class="slbl">Scalp Ready</div></div>
  </div>
  <div class="tbl-outer">
    <div class="scalp-head"><div>#</div><div>Ticker</div><div>Signal</div><div>Price</div><div>5m Chg%</div><div>Vol Spike</div><div>vs VWAP</div><div>Momentum</div><div>Entry / Target / Stop</div><div>RS vs SPY</div><div>Score</div></div>
    <div id="sBody"><div class="msg">Press SCAN NOW to find scalp opportunities right now</div></div>
  </div>
  <div class="foot"><span>Yahoo Finance Â· 5-min candles Â· Refresh every scan Â· Not financial advice</span><span id="sFoot"></span></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SWING TRADER TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-w" class="tab-panel">
  <div class="hdr">
    <div><div class="title-w">NDX100 BUY SCANNER</div><div class="sub">Yahoo Finance Â· All 100 Tickers Â· RSI-14 Â· EMA-20/200 Â· SMA-50 Â· TTM Squeeze Â· Trend Strength Â· Top 10 Ranked</div></div>
    <div class="hdr-right">
      <button class="btn-w" id="wBtn" onclick="runSwing()">&#9654; RESCAN ALL 100</button>
      <div style="font-size:9px;color:var(--sdim);text-align:right;letter-spacing:.06em"><span style="color:var(--sg)">No API key needed</span> Â· Yahoo Finance Â· ~60s scan time</div>
    </div>
  </div>
  <div class="criteria">
    <div class="crit"><div class="cdot" style="background:var(--sg)"></div>Bullish trend (EMA20 &gt; SMA50)</div>
    <div class="crit"><div class="cdot" style="background:var(--sy)"></div>Trend strength &gt; 10%</div>
    <div class="crit"><div class="cdot" style="background:var(--sp)"></div>Squeeze &gt; 70%</div>
    <div class="crit"><div class="cdot" style="background:var(--sb)"></div>Price above EMA200</div>
    <div class="crit"><div class="cdot" style="background:var(--sg)"></div>RSI 30â€“65 buy zone Â· &lt;30 oversold â˜…</div>
    <div class="crit"><div class="cdot" style="background:var(--sr)"></div>Dip below SMA50 (bonus)</div>
  </div>
  <div class="prog-wrap" id="wProg"><div class="prog-lbl"><span id="wPL">Scanning...</span><span id="wPP">0%</span></div><div class="prog-bg"><div class="pfw" id="wPF" style="width:0%"></div></div></div>
  <div class="log" id="wLog"></div>
  <div class="stats">
    <div class="stat"><div class="snum"    id="w1">â€”</div><div class="slbl">Scanned</div></div>
    <div class="stat"><div class="snum sg" id="w2">â€”</div><div class="slbl">Bullish Trend</div></div>
    <div class="stat"><div class="snum y"  id="w3">â€”</div><div class="slbl">RSI Buy Zone</div></div>
    <div class="stat"><div class="snum p"  id="w4">â€”</div><div class="slbl">Squeeze &gt;70%</div></div>
    <div class="stat"><div class="snum sg" id="w5">â€”</div><div class="slbl">Oversold &lt;30</div></div>
    <div class="stat"><div class="snum"    id="w6">â€”</div><div class="slbl">Avg RSI</div></div>
  </div>
  <div class="sw-wrap">
    <table>
      <thead><tr>
        <th>#</th><th>Ticker</th><th>Signal</th>
        <th>Price</th><th>RSI-14</th><th>EMA-20</th><th>EMA-200</th>
        <th>SMA-50</th><th>Trend%</th><th>Squeeze</th><th>Score</th>
      </tr></thead>
      <tbody id="wBody"><tr class="msg-row"><td colspan="11">Press RESCAN ALL 100 to load swing trade data</td></tr></tbody>
    </table>
  </div>
  <div class="foot"><span>Yahoo Finance Â· 400-day history Â· RSI Â· EMA Â· SMA Â· TTM Squeeze Â· Not financial advice</span><span id="wFoot"></span></div>
</div>

</div><!-- /wrap -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(t) {
  ['d','s','w'].forEach(x => {
    document.getElementById('tab-'+x).classList.toggle('active', x===t);
    const b = document.getElementById('tb-'+x);
    b.className = 'tab-btn' + (x===t ? ' t'+x : '');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELEGRAM â€” direct API, checkbox gated
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TG_TOKEN   = "8570415382:AAF7q0vmO_Vy-KEar2r48fRvoAuLzFAXlZY";
const TG_CHAT_ID = "1026720092";
let tgEnabled = false;

function toggleTG() {
  tgEnabled = !tgEnabled;
  document.getElementById("tgTrack").style.background  = tgEnabled ? "var(--green)"  : "var(--muted)";
  document.getElementById("tgTrack").style.borderColor = tgEnabled ? "var(--green)"  : "var(--border)";
  document.getElementById("tgThumb").style.background  = tgEnabled ? "#000"          : "var(--dim)";
  document.getElementById("tgThumb").style.left        = tgEnabled ? "22px"          : "3px";
  document.getElementById("tgLabel").textContent       = tgEnabled ? "ğŸ“² TELEGRAM ALERTS ON" : "ğŸ“² TELEGRAM ALERTS OFF";
  document.getElementById("tgLabel").style.color       = tgEnabled ? "var(--green)"  : "var(--dim)";
}

async function sendAlert(sym,name,price,chgPct,score,maxPts,signal,tags) {
  if (!tgEnabled) return;
  const emoji  = score >= 11 ? "ğŸ”¥" : score >= 8 ? "âš¡" : "ğŸ¯";
  const msg = `${emoji} *${signal} â€” NDX100*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ *${sym}* â€” ${name}
ğŸ’° Price: $${typeof price === 'number' ? price.toFixed(2) : price}
ğŸ“ˆ Change: ${chgPct >= 0 ? "+" : ""}${typeof chgPct === 'number' ? chgPct.toFixed(2) : chgPct}%
â­ Score: ${score}/${maxPts}
ğŸ“Š ${tags}
â° ${new Date().toLocaleTimeString()}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;
  try {
    await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({chat_id: TG_CHAT_ID, text: msg, parse_mode: "Markdown"})
    });
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED TICKER LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let TICKERS = [];        // will be filled dynamically
let TICKERS_LOADED = false;

// Try to load Nasdaq-100 list dynamically (Wikipedia is easiest to parse)
async function fetchNDX100List(){
  const url="https://en.wikipedia.org/wiki/Nasdaq-100";
  const r=await proxyFetch(url);
  const html=await r.text();
  const doc=new DOMParser().parseFromString(html,"text/html");

  // Find a wikitable whose header mentions ticker/symbol
  const tables=Array.from(doc.querySelectorAll("table.wikitable"));
  let best=null;
  for(const t of tables){
    const headerText=(t.querySelector("tr")?.innerText||"").toLowerCase();
    if(headerText.includes("ticker")||headerText.includes("symbol")){
      best=t; break;
    }
  }
  if(!best) throw new Error("Could not find constituents table");

  // Determine symbol column index
  const headerRow=best.querySelector("tr");
  const headerCells=Array.from(headerRow.querySelectorAll("th")).map(th=>th.innerText.trim().toLowerCase());
  let symCol=headerCells.findIndex(h=>h.includes("ticker")||h.includes("symbol"));
  if(symCol<0) symCol=0;

  const rows=Array.from(best.querySelectorAll("tr")).slice(1);
  const out=[];
  const seen=new Set();

  for(const row of rows){
    const cells=Array.from(row.querySelectorAll("td"));
    if(!cells.length) continue;
    const symRaw=(cells[symCol]?.innerText||"").trim();
    if(!symRaw) continue;

    const cleaned=symRaw.replace(/\s+/g,"").replace(/\[.*?\]/g,"");
    if(!cleaned) continue;

    // Yahoo often uses '-' instead of '.' (e.g., BRK.B -> BRK-B)
    const yahooSym=cleaned.includes(".") ? cleaned.replace(".", "-") : cleaned;
    const sym=yahooSym.toUpperCase();
    if(seen.has(sym)) continue;
    seen.add(sym);

    // Best-effort company name (use another column if present)
    const name=(cells.find((_,i)=>i!==symCol)?.innerText||sym).trim();
    out.push({sym, name});
  }
  if(out.length<80) throw new Error(`Got too few tickers (${out.length})`);
  return out.slice(0,110); // safety cap
}

async function ensureTickersLoaded(logId){
  if(TICKERS_LOADED && TICKERS.length) return;
  try{
    if(logId) logTo(logId,"â–º Loading Nasdaq-100 listâ€¦","linfo");
    TICKERS = await fetchNDX100List();
    TICKERS_LOADED = true;
    if(logId) logTo(logId,`âœ“ Loaded ${TICKERS.length} tickers (dynamic NDX100)`,"lok");
  }catch(e){
    if(logId) logTo(logId,`âš  Dynamic NDX100 list failed (${e.message}). Using fallback list.`,"lwarn");
    // Fallback list (top names) so the app still runs
    TICKERS = [
      {sym:"AAPL",name:"Apple"},{sym:"MSFT",name:"Microsoft"},{sym:"NVDA",name:"NVIDIA"},
      {sym:"AMZN",name:"Amazon"},{sym:"META",name:"Meta Platforms"},{sym:"TSLA",name:"Tesla"},
      {sym:"GOOGL",name:"Alphabet A"},{sym:"GOOG",name:"Alphabet C"},{sym:"AVGO",name:"Broadcom"},
      {sym:"COST",name:"Costco"},{sym:"AMD",name:"Advanced Micro Devices"},{sym:"NFLX",name:"Netflix"},
      {sym:"ADBE",name:"Adobe"},{sym:"PEP",name:"PepsiCo"},{sym:"CSCO",name:"Cisco"},
      {sym:"INTC",name:"Intel"},{sym:"TXN",name:"Texas Instruments"},{sym:"AMAT",name:"Applied Materials"},
      {sym:"QCOM",name:"Qualcomm"},{sym:"MU",name:"Micron"},{sym:"HON",name:"Honeywell"},
      {sym:"SBUX",name:"Starbucks"},{sym:"BKNG",name:"Booking"},{sym:"REGN",name:"Regeneron"},
      {sym:"PYPL",name:"PayPal"},{sym:"COIN",name:"Coinbase"}
    ];
    TICKERS_LOADED = true;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOG HELPER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function logTo(id, msg, cls="") {
  const b = document.getElementById(id);
  b.classList.add("on");
  const d = document.createElement("div");
  d.textContent = msg; d.className = cls;
  b.appendChild(d); b.scrollTop = b.scrollHeight;
}
function rnCls(i){return i===0?"gold":i===1?"silver":i===2?"bronze":"";}
function rbColor(i,mode){
  if(mode==="s") return i===0?"#ff3355":i===1?"#fb923c":i===2?"#ffd700":"#0d1f2d";
  return i===0?"#f59e0b":i===1?"#94a3b8":i===2?"#b45309":"#0d1f2d";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// YAHOO FINANCE FETCHERS â€” auto fallback proxies on 429
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let dCache={}, sCache={}, wCache={};

// Three proxies â€” tried in order, auto-fallback on 429
const PROXIES = [
  url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
  url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
  url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
];

async function proxyFetch(yahooUrl) {
  for (let i = 0; i < PROXIES.length; i++) {
    try {
      const r = await fetch(PROXIES[i](yahooUrl));
      if (r.status === 429) { continue; } // rate limited â€” try next proxy
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r;
    } catch(e) {
      if (i === PROXIES.length - 1) throw e; // all proxies failed
    }
  }
}

async function yhDay(sym) {
  if(dCache[sym]) return dCache[sym];
  const now=Math.floor(Date.now()/1000), start=now-7*3600;
  const [ir,dr] = await Promise.all([
    proxyFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=5m&period1=${start}&period2=${now}`),
    proxyFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=1d&range=3mo`)
  ]);
  const ij=await ir.json(), dj=await dr.json();
  const intra=ij?.chart?.result?.[0], daily=dj?.chart?.result?.[0];
  if(!intra||!daily) throw new Error("No data");
  const m=intra.meta, iQ=intra.indicators?.quote?.[0], dQ=daily.indicators?.quote?.[0];
  const price=m.regularMarketPrice||m.previousClose, prev=m.previousClose||m.chartPreviousClose;
  const open=m.regularMarketOpen||prev, high=m.regularMarketDayHigh||price, low=m.regularMarketDayLow||price;
  const r={price,prev,open,high,low,
    chgPct:prev>0?((price-prev)/prev)*100:0,
    gapPct:prev>0?((open-prev)/prev)*100:0,
    candles:(iQ&&intra.timestamp)?{c:iQ.close,h:iQ.high,l:iQ.low,v:iQ.volume}:null,
    closes:dQ.close.map(v=>v??0), volumes:dQ.volume.map(v=>v??0),
    highs:dQ.high.map(v=>v??0),   lows:dQ.low.map(v=>v??0)};
  dCache[sym]=r; return r;
}

async function yhScalp(sym) {
  if(sCache[sym]) return sCache[sym];
  const now=Math.floor(Date.now()/1000), start=now-7*3600;
  const r=await proxyFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=5m&period1=${start}&period2=${now}`);
  const j=await r.json(), res=j?.chart?.result?.[0];
  if(!res) throw new Error("No data");
  const m=res.meta, q=res.indicators?.quote?.[0], t=res.timestamp||[];
  if(!q||!q.close||q.close.length<5) throw new Error("Not enough candles");
  const candles=[];
  for(let i=0;i<t.length;i++) if(q.close[i]&&q.open[i]&&q.high[i]&&q.low[i]&&q.volume[i])
    candles.push({t:t[i],o:q.open[i],h:q.high[i],l:q.low[i],c:q.close[i],v:q.volume[i]});
  if(candles.length<5) throw new Error("Too few candles");
  const rv={price:m.regularMarketPrice||candles[candles.length-1].c, candles};
  sCache[sym]=rv; return rv;
}

async function yhSwing(sym) {
  if(wCache[sym]) return wCache[sym];
  const to=Math.floor(Date.now()/1000), from=to-400*86400;
  const r=await proxyFetch(`https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=1d&period1=${from}&period2=${to}`);
  const json=await r.json(), res=json?.chart?.result?.[0];
  if(!res) throw new Error(json?.chart?.error?.description||"No data");
  const q=res.indicators.quote[0], adj=res.indicators.adjclose?.[0]?.adjclose||q.close;
  const valid=res.timestamp.map((t,i)=>({c:adj[i],h:q.high[i],l:q.low[i],o:q.open[i],v:q.volume[i]})).filter(x=>x.c!=null&&x.h!=null&&x.l!=null);
  if(valid.length<60) throw new Error(`Only ${valid.length} days`);
  const rv={closes:valid.map(x=>x.c), highs:valid.map(x=>x.h), lows:valid.map(x=>x.l),
    price:res.meta.regularMarketPrice||valid[valid.length-1].c, chgPct:res.meta.regularMarketChangePercent||0};
  wCache[sym]=rv; return rv;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED MATH / INDICATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function vwapArr(c,h,l,v){if(!c)return null;let tp=0,vl=0;for(let i=0;i<c.length;i++){if(!c[i]||!v[i])continue;tp+=((h[i]+l[i]+c[i])/3)*v[i];vl+=v[i];}return vl>0?tp/vl:null;}
function vwapObj(cs){let tp=0,vl=0;for(const c of cs){const t=(c.h+c.l+c.c)/3;tp+=t*c.v;vl+=c.v;}return vl>0?tp/vl:null;}
function avgVol(vols,n=20){if(vols.length<n)return null;return vols.slice(-n-1,-1).reduce((a,b)=>a+b,0)/n;}
function atr(highs,lows,closes,n=14){if(closes.length<n+1)return null;const tr=[];for(let i=closes.length-n;i<closes.length;i++)tr.push(Math.max(highs[i]-lows[i],Math.abs(highs[i]-closes[i-1]),Math.abs(lows[i]-closes[i-1])));return tr.reduce((a,b)=>a+b,0)/n;}
function intVol(c){if(!c?.v)return 0;return c.v.reduce((a,b)=>a+(b||0),0);}
function bullStreak(c,n){return c.slice(-n).every(x=>x.c>x.o);}
function vSpike(c){if(c.length<11)return 0;const l=c[c.length-1],p=c.slice(-11,-1),a=p.reduce((x,y)=>x+y.v,0)/10;return a>0?l.v/a:0;}
function isAccel(c){if(c.length<4)return false;const c1=c[c.length-1],c3=c[c.length-3];return c1.c>c1.o&&Math.abs(c1.c-c1.o)>Math.abs(c3.c-c3.o);}
function r5m(c){if(c.length<4)return 0;const n=c[c.length-1].c,a=c[c.length-4].c;return a>0?((n-a)/a)*100:0;}
function levels(c,p){const a=c.slice(-5).reduce((x,y)=>x+(y.h-y.l),0)/5;return{entry:p,target:+(p+a*1.5).toFixed(2),stop:+(p-a*0.75).toFixed(2)};}
function ema(arr,p){if(arr.length<p)return null;const k=2/(p+1);let v=arr.slice(0,p).reduce((a,b)=>a+b,0)/p;for(let i=p;i<arr.length;i++)v=arr[i]*k+v*(1-k);return v;}
function sma(arr,p){if(arr.length<p)return null;return arr.slice(-p).reduce((a,b)=>a+b,0)/p;}
function rsi14(c){if(c.length<15)return null;let g=0,l=0;for(let i=c.length-14;i<c.length;i++){const d=c[i]-c[i-1];if(d>0)g+=d;else l-=d;}const ag=g/14,al=l/14;return al===0?100:100-100/(1+ag/al);}
function squeeze(h,l,c){const n=c.length;if(n<20)return{pct:null,inSq:false};const s=sma(c,20),sl=c.slice(-20),mean=sl.reduce((a,b)=>a+b,0)/20,sd=Math.sqrt(sl.reduce((a,b)=>a+Math.pow(b-mean,2),0)/20);const bbU=s+2*sd,bbL=s-2*sd,trs=[];for(let i=Math.max(1,n-21);i<n;i++)trs.push(Math.max(h[i]-l[i],Math.abs(h[i]-c[i-1]),Math.abs(l[i]-c[i-1])));const at=trs.reduce((a,b)=>a+b,0)/trs.length,kcU=s+1.5*at,kcL=s-1.5*at,pct=kcU-kcL>0?Math.round(Math.max(0,Math.min(1,1-(bbU-bbL)/(kcU-kcL)))*100):0;return{pct,inSq:bbU<kcU&&bbL>kcL};}
function trendStr(c){const e20=ema(c,20),s50=sma(c,50);if(!e20||!s50)return{pct:0,rawPct:0,dir:"neu"};const diff=(e20-s50)/s50*100;return{pct:Math.min(100,Math.abs(diff)*8),rawPct:diff,dir:diff>0.15?"bull":diff<-0.15?"bear":"neu"};}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAY SCANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const D_MAX=14;
function dScore(d){
  let pts=0; const tags=[];
  if(d.chgPct>=3){pts+=4;tags.push({t:"ğŸ”¥ +"+d.chgPct.toFixed(1)+"%",c:"tg"});}
  else if(d.chgPct>=2){pts+=3;tags.push({t:"â–² +"+d.chgPct.toFixed(1)+"%",c:"tg"});}
  else if(d.chgPct>=1){pts+=2;tags.push({t:"â–² +"+d.chgPct.toFixed(1)+"%",c:"ty"});}
  else if(d.chgPct>=0){pts+=1;tags.push({t:"â†’ +"+d.chgPct.toFixed(1)+"%",c:"ta"});}
  else tags.push({t:"â–¼ "+d.chgPct.toFixed(1)+"%",c:"tr"});
  if(d.vr>=2.5){pts+=3;tags.push({t:"VOL "+d.vr.toFixed(1)+"x ğŸš€",c:"tg"});}
  else if(d.vr>=1.5){pts+=2;tags.push({t:"VOL "+d.vr.toFixed(1)+"x â†‘",c:"ty"});}
  else if(d.vr>=1.1){pts+=1;tags.push({t:"VOL "+d.vr.toFixed(1)+"x",c:"ta"});}
  else if(d.vr>0) tags.push({t:"VOL LOW",c:"tr"});
  if(d.rs>1.5){pts+=2;tags.push({t:"RS +"+d.rs.toFixed(1)+"% vs SPY",c:"tg"});}
  else if(d.rs>0){pts+=1;tags.push({t:"RS +"+d.rs.toFixed(1)+"% vs SPY",c:"ty"});}
  else tags.push({t:"RS "+d.rs.toFixed(1)+"% vs SPY",c:"tr"});
  if(d.gap>=1.5){pts+=2;tags.push({t:"GAP UP +"+d.gap.toFixed(1)+"%",c:"tp"});}
  else if(d.gap>=0.3){pts+=1;tags.push({t:"GAP +"+d.gap.toFixed(1)+"%",c:"ta"});}
  if(d.abvVWAP===true){pts+=2;tags.push({t:"ABOVE VWAP âœ“",c:"tg"});}
  else if(d.abvVWAP===false) tags.push({t:"BELOW VWAP",c:"tr"});
  if(d.rr>=1.3){pts+=1;tags.push({t:"RANGE "+d.rr.toFixed(1)+"x ATR",c:"to"});}
  return{pts,tags};
}
function dSigLabel(p){
  if(p>=11)return`<span style="color:var(--green);font-weight:700">ğŸ”¥ STRONG MOMENTUM</span>`;
  if(p>=8) return`<span style="color:var(--yellow);font-weight:700">âš¡ MOMENTUM</span>`;
  if(p>=5) return`<span style="color:var(--accent);font-weight:700">â—ˆ WATCH</span>`;
  return`<span style="color:var(--dim)">â—‡ WEAK</span>`;
}
function renderDay(data){
  const b=document.getElementById("dBody");
  if(!data.length){b.innerHTML=`<div class="msg">No results found</div>`;return;}
  b.innerHTML=data.slice(0,10).map((d,i)=>{
    const sc=d._s; const col=sc.pts>=11?"#00ff88":sc.pts>=8?"#ffd700":sc.pts>=5?"#00d4ff":"#3a5a6a";
    const cc=d.chgPct>=0?"pos":"neg", cs=d.chgPct>=0?"â–²":"â–¼";
    const vrF=d.vr>0?Math.min(100,(d.vr/3)*100):0, vrC=d.vr>=2?"bfg":d.vr>=1.2?"bfy":"bfr";
    const rsF=Math.min(100,Math.max(0,(d.rs+3)/6*100));
    const rrF=d.rr>0?Math.min(100,(d.rr/2)*100):0;
    const gC=d.gap>=1?"bfg":d.gap>=0?"bfy":"bfr";
    const vl=d.abvVWAP===true?`<span style="color:var(--green);font-weight:700">ABOVE</span>`:d.abvVWAP===false?`<span style="color:var(--red)">BELOW</span>`:`<span style="color:var(--dim)">â€”</span>`;
    const th=sc.tags.map(t=>`<span class="tag ${t.c}">${t.t}</span>`).join("");
    return`<div class="day-row trow-anim" style="animation-delay:${i*0.06}s">
      <div class="rankbar" style="background:${rbColor(i,'d')}"></div>
      <div class="cell"><span class="rnum ${rnCls(i)}">${i+1}</span></div>
      <div class="cell col"><span class="tsym">${d.sym}</span><span class="tname">${d.name}</span></div>
      <div class="cell col">${dSigLabel(sc.pts)}<div class="sig-tags">${th}</div></div>
      <div class="cell col"><span class="pval">$${d.price.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}</span><span class="chg ${cc}">${cs} ${Math.abs(d.chgPct).toFixed(2)}%</span></div>
      <div class="cell col"><span class="chg ${cc}" style="font-size:13px">${cs}${Math.abs(d.chgPct).toFixed(2)}%</span><div class="bar-mini"><div class="bf ${d.chgPct>=0?'bfg':'bfr'}" style="width:${Math.min(100,Math.abs(d.chgPct)/5*100)}%"></div></div></div>
      <div class="cell col"><span style="font-size:13px;font-weight:700;color:${d.vr>=1.5?'var(--yellow)':'var(--dim)'}">${d.vr>0?d.vr.toFixed(2)+"x":"â€”"}</span><div class="bar-mini"><div class="bf ${vrC}" style="width:${vrF}%"></div></div></div>
      <div class="cell col"><span style="font-size:13px;font-weight:700;color:${d.rs>0?'var(--green)':'var(--red)'}">${d.rs>0?"+":""}${d.rs.toFixed(2)}%</span><div class="bar-mini"><div class="bf ${d.rs>0?'bfg':'bfr'}" style="width:${rsF}%"></div></div></div>
      <div class="cell col"><span style="font-size:13px;font-weight:700;color:${d.gap>=1?'var(--green)':d.gap>=0?'var(--yellow)':'var(--red)'}">${d.gap>=0?"+":""}${d.gap.toFixed(2)}%</span><div class="bar-mini"><div class="bf ${gC}" style="width:${Math.min(100,Math.abs(d.gap)/4*100)}%"></div></div></div>
      <div class="cell col"><span style="font-size:13px;font-weight:700;color:${d.rr>=1.3?'var(--orange)':'var(--dim)'}">${d.rr>0?d.rr.toFixed(2)+"x ATR":"â€”"}</span><div class="bar-mini"><div class="bf bfo" style="width:${rrF}%"></div></div></div>
      <div class="cell">${vl}</div>
      <div class="cell col"><span class="score-num" style="color:${col}">${sc.pts}</span><span class="score-den">/${D_MAX}</span><div class="score-bar"><div class="sfd" style="width:${(sc.pts/D_MAX)*100}%"></div></div></div>
    </div>`;
  }).join("");
}
async function runDay(){
  dCache={};
  const btn=document.getElementById("dBtn"); btn.disabled=true; btn.textContent="SCANNING...";
  document.getElementById("dLog").innerHTML=""; document.getElementById("dLog").className="log on";
  await ensureTickersLoaded("dLog");
  document.getElementById("dProg").className="prog-wrap on";
  document.getElementById("dBody").innerHTML=`<div class="msg"><span class="spin"></span>FETCHING LIVE DATA...</div>`;
  document.getElementById("dDot").style.background="var(--yellow)";
  document.getElementById("dStat").style.color="var(--yellow)"; document.getElementById("dStat").textContent="SCANNING";
  const t0=Date.now(); let spyChg=null, spyPct=0;
  try {
    const spy=await yhDay("SPY"); spyChg=spy.chgPct; spyPct=spy.chgPct||0;
    document.getElementById("dSpyVol").textContent="Live"; document.getElementById("dSpyVol").style.color="var(--accent)";
    logTo("dLog",`âœ“ SPY: ${spyChg>=0?"+":""}${spyChg.toFixed(2)}% today`,"lok");
  } catch(e){logTo("dLog",`âš  SPY failed: ${e.message}`,"lwarn");}
  const results=[], total=TICKERS.length;
  logTo("dLog",`â–º Scanning ${total} stocks...`,"linfo");
  for(let i=0;i<total;i++){
    const t=TICKERS[i], pct=Math.round(((i+1)/total)*100);
    document.getElementById("dPL").textContent=`${i+1}/${total} â€” ${t.sym}`;
    document.getElementById("dPP").textContent=pct+"%"; document.getElementById("dPF").style.width=pct+"%";
    try {
      const yh=await yhDay(t.sym);
      const{price,chgPct,high,low,gapPct,candles}=yh;
      const ir=high-low, rs=chgPct-spyPct;
      const vwap=vwapArr(candles?.c,candles?.h,candles?.l,candles?.v);
      const abvVWAP=vwap!==null?price>vwap:null;
      const iv=intVol(candles), av=avgVol(yh.volumes,20);
      const tv=iv>0?iv:(yh.volumes[yh.volumes.length-1]||0);
      const vr=av>0?tv/av:0;
      const at=atr(yh.highs,yh.lows,yh.closes,14);
      const rr=(at>0&&ir>0)?ir/at:0;
      const d={sym:t.sym,name:t.name,price,chgPct,gap:gapPct,rs,vr,rr,abvVWAP};
      d._s=dScore(d); results.push(d);
      logTo("dLog",`âœ“ ${t.sym.padEnd(6)} | ${chgPct>=0?"+":""}${chgPct.toFixed(2)}% | VOL:${vr>0?vr.toFixed(1)+"x":"â€”"} | RS:${rs>=0?"+":""}${rs.toFixed(1)}% | ${d._s.pts}/${D_MAX}pts`,"lok");
    } catch(e){logTo("dLog",`âœ— ${t.sym} â€” ${e.message}`,"lerr");}
    if(i<total-1) await new Promise(r=>setTimeout(r,400));
  }
  results.sort((a,b)=>b._s.pts!==a._s.pts?b._s.pts-a._s.pts:b.chgPct-a.chgPct);
  renderDay(results);
  document.getElementById("d1").textContent=results.length;
  document.getElementById("d2").textContent=results.filter(d=>d.chgPct>=1).length;
  document.getElementById("d3").textContent=results.filter(d=>d.vr>=1.5).length;
  document.getElementById("d4").textContent=results.filter(d=>d.rs>0).length;
  document.getElementById("d5").textContent=results.filter(d=>d.gap>=0.5).length;
  const avg=results.length?(results.reduce((a,b)=>a+b.chgPct,0)/results.length).toFixed(2):"â€”";
  const ae=document.getElementById("d6"); ae.textContent=avg!=="â€”"?(avg>=0?"+":"")+avg+"%":"â€”"; ae.className="snum "+(parseFloat(avg)>=0?"g":"r");
  if(spyChg!==null){document.getElementById("dSpyChg").textContent=(spyChg>=0?"+":"")+spyChg.toFixed(2)+"%";document.getElementById("dSpyChg").style.color=spyChg>=0?"var(--green)":"var(--red)";document.getElementById("dRegime").textContent=spyChg>=0.3?"BULLISH DAY":spyChg<=-0.3?"BEARISH DAY":"CHOPPY";document.getElementById("dRegime").style.color=spyChg>=0.3?"var(--green)":spyChg<=-0.3?"var(--red)":"var(--yellow)";}
  const el=((Date.now()-t0)/1000).toFixed(1);
  document.getElementById("dScanT").textContent=el+"s"; document.getElementById("dScanT").style.color="var(--accent)";
  document.getElementById("dFoot").textContent=`Scanned ${results.length} in ${el}s Â· Top: ${results[0]?.sym||"â€”"} Â· ${new Date().toLocaleTimeString()}`;
  document.getElementById("dDot").style.background="var(--green)"; document.getElementById("dStat").style.color="var(--green)"; document.getElementById("dStat").textContent="DONE";
  document.getElementById("dProg").className="prog-wrap"; document.getElementById("dTime").textContent=new Date().toLocaleTimeString();
  if(results[0]) logTo("dLog",`\nâ–º TOP: ${results[0].sym} â€” ${results[0]._s.pts}/${D_MAX}pts Â· +${results[0].chgPct.toFixed(2)}%`,"linfo");
  for(const x of results.filter(d=>d._s.pts>=8)){
    await sendAlert(x.sym,x.name,x.price,x.chgPct,x._s.pts,D_MAX,x._s.pts>=11?"STRONG MOMENTUM":"MOMENTUM",x._s.tags.map(t=>t.t).join(" Â· "));
    await new Promise(r=>setTimeout(r,300));
  }
  btn.disabled=false; btn.textContent="â–¶ RESCAN";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCALP SCANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S_MAX=12;
function sScore(d){
  let pts=0; const tags=[];
  if(d.b3){pts+=3;tags.push({t:"3 BULL CANDLES âœ“",c:"tg"});}
  else if(d.b2){pts+=1;tags.push({t:"2 BULL CANDLES",c:"ty"});}
  else tags.push({t:"NO STREAK",c:"tr"});
  if(d.vs>=2.5){pts+=3;tags.push({t:"VOL "+d.vs.toFixed(1)+"x ğŸš€",c:"tg"});}
  else if(d.vs>=1.5){pts+=2;tags.push({t:"VOL "+d.vs.toFixed(1)+"x â†‘",c:"ty"});}
  else if(d.vs>=1.1){pts+=1;tags.push({t:"VOL "+d.vs.toFixed(1)+"x",c:"ta"});}
  else tags.push({t:"VOL WEAK",c:"tr"});
  if(d.abv){pts+=2;tags.push({t:"ABOVE VWAP âœ“",c:"tg"});}else tags.push({t:"BELOW VWAP",c:"tr"});
  if(d.ac){pts+=2;tags.push({t:"ACCEL âš¡",c:"to"});}
  if(d.rs>0.3){pts+=2;tags.push({t:"RS +"+d.rs.toFixed(2)+"%",c:"tg"});}
  else if(d.rs>0){pts+=1;tags.push({t:"RS +"+d.rs.toFixed(2)+"%",c:"ty"});}
  else tags.push({t:"RS "+d.rs.toFixed(2)+"%",c:"tr"});
  return{pts,tags};
}
function sSigLabel(p){
  if(p>=10)return`<span style="color:var(--red);font-weight:700">ğŸ¯ SCALP NOW</span>`;
  if(p>=7) return`<span style="color:var(--orange);font-weight:700">âš¡ STRONG SETUP</span>`;
  if(p>=5) return`<span style="color:var(--yellow);font-weight:700">â—ˆ WATCH</span>`;
  return`<span style="color:var(--dim)">â—‡ SKIP</span>`;
}
function renderScalp(data){
  const b=document.getElementById("sBody");
  if(!data.length){b.innerHTML=`<div class="msg">No setups found</div>`;return;}
  b.innerHTML=data.slice(0,10).map((d,i)=>{
    const sc=d._s; const col=sc.pts>=10?"#ff3355":sc.pts>=7?"#fb923c":sc.pts>=5?"#ffd700":"#3a5a6a";
    const cc=d.c5m>=0?"pos":"neg", cs=d.c5m>=0?"â–²":"â–¼";
    const vF=Math.min(100,(d.vs/3)*100), vC=d.vs>=2?"bfg":d.vs>=1.2?"bfy":"bfr";
    const rsF=Math.min(100,Math.max(0,(d.rs+1)/2*100));
    const lvl=d.lvl, rr=lvl.target>lvl.entry&&lvl.entry>lvl.stop?((lvl.target-lvl.entry)/(lvl.entry-lvl.stop)).toFixed(1):"â€”";
    const th=sc.tags.map(t=>`<span class="tag ${t.c}">${t.t}</span>`).join("");
    return`<div class="scalp-row trow-anim" style="animation-delay:${i*0.05}s">
      <div class="rankbar" style="background:${rbColor(i,'s')}"></div>
      <div class="cell"><span class="rnum ${rnCls(i)}">${i+1}</span></div>
      <div class="cell col"><span class="tsym">${d.sym}</span><span class="tname">${d.name}</span></div>
      <div class="cell col">${sSigLabel(sc.pts)}<div class="sig-tags">${th}</div></div>
      <div class="cell col"><span style="font-size:14px;font-weight:700;color:var(--text)">$${d.price.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}</span><span style="font-size:9px;color:var(--dim)">VWAP $${d.vwap?d.vwap.toFixed(2):"â€”"}</span></div>
      <div class="cell col"><span class="chg ${cc}" style="font-size:13px">${cs}${Math.abs(d.c5m).toFixed(2)}%</span><div class="bar-mini"><div class="bf ${d.c5m>=0?'bfg':'bfr'}" style="width:${Math.min(100,Math.abs(d.c5m)/2*100)}%"></div></div></div>
      <div class="cell col"><span style="font-size:13px;font-weight:700;color:${d.vs>=1.5?'var(--yellow)':'var(--dim)'}">${d.vs>0?d.vs.toFixed(1)+"x":"â€”"}</span><div class="bar-mini"><div class="bf ${vC}" style="width:${vF}%"></div></div></div>
      <div class="cell">${d.abv?`<span style="color:var(--green);font-weight:700">ABOVE âœ“</span>`:`<span style="color:var(--red)">BELOW</span>`}</div>
      <div class="cell">${d.ac?`<span style="color:var(--orange);font-weight:700">ACCEL âš¡</span>`:`<span style="color:var(--dim)">FLAT</span>`}</div>
      <div class="cell"><div class="target-box"><span class="te">ENTRY $${lvl.entry.toFixed(2)}</span><span class="tt">TARGET $${lvl.target.toFixed(2)}</span><span class="ts2">STOP $${lvl.stop.toFixed(2)} Â· R:R ${rr}</span></div></div>
      <div class="cell col"><span style="font-size:13px;font-weight:700;color:${d.rs>0?'var(--green)':'var(--red)'}">${d.rs>0?"+":""}${d.rs.toFixed(2)}%</span><div class="bar-mini"><div class="bf ${d.rs>0?'bfg':'bfr'}" style="width:${rsF}%"></div></div></div>
      <div class="cell col"><span class="score-num" style="color:${col}">${sc.pts}</span><span class="score-den">/${S_MAX}</span><div class="score-bar"><div class="sfs" style="width:${(sc.pts/S_MAX)*100}%"></div></div></div>
    </div>`;
  }).join("");
}
async function runScalp(){
  sCache={};
  const btn=document.getElementById("sBtn"); btn.disabled=true; btn.textContent="SCANNING...";
  document.getElementById("sLog").innerHTML=""; document.getElementById("sLog").className="log on";
  await ensureTickersLoaded("sLog");
  document.getElementById("sProg").className="prog-wrap on";
  document.getElementById("sBody").innerHTML=`<div class="msg"><span class="spin"></span>SCANNING 5-MIN CANDLES...</div>`;
  document.getElementById("sDot").style.background="var(--yellow)";
  document.getElementById("sStat").style.color="var(--yellow)"; document.getElementById("sStat").textContent="SCANNING";
  const t0=Date.now(); let spy5m=0, spyBull=false, spyAc=false;
  try {
    const sp=await yhScalp("SPY"); spy5m=r5m(sp.candles); spyBull=bullStreak(sp.candles,3); spyAc=isAccel(sp.candles);
    logTo("sLog",`âœ“ SPY 5m: ${spy5m>=0?"+":""}${spy5m.toFixed(2)}% | Bull:${spyBull?"YES":"NO"} | Accel:${spyAc?"YES":"NO"}`,"lok");
    document.getElementById("sSpy5m").textContent=(spy5m>=0?"+":"")+spy5m.toFixed(2)+"% (5m)"; document.getElementById("sSpy5m").style.color=spy5m>=0?"var(--green)":"var(--red)";
    document.getElementById("sRegime").textContent=spyBull?"BULLISH":spy5m>0?"RISING":"FALLING"; document.getElementById("sRegime").style.color=spyBull?"var(--green)":spy5m>0?"var(--yellow)":"var(--red)";
    document.getElementById("sMom").textContent=spyAc?"ACCEL âš¡":"STEADY"; document.getElementById("sMom").style.color=spyAc?"var(--orange)":"var(--dim)";
  } catch(e){logTo("sLog",`âš  SPY failed: ${e.message}`,"lwarn");}
  const results=[], total=TICKERS.length;
  logTo("sLog",`â–º Scanning ${total} stocks for scalp setups...`,"linfo");
  for(let i=0;i<total;i++){
    const t=TICKERS[i], pct=Math.round(((i+1)/total)*100);
    document.getElementById("sPL").textContent=`${i+1}/${total} â€” ${t.sym}`;
    document.getElementById("sPP").textContent=pct+"%"; document.getElementById("sPF").style.width=pct+"%";
    try {
      const yh=await yhScalp(t.sym); const{price,candles}=yh;
      const vwap=vwapObj(candles), abv=vwap!==null?price>vwap:false;
      const vs=vSpike(candles), b3=bullStreak(candles,3), b2=bullStreak(candles,2);
      const ac=isAccel(candles), c5m=r5m(candles), rs=c5m-spy5m, lvl=levels(candles,price);
      const d={sym:t.sym,name:t.name,price,vwap,abv,vs,b3,b2,ac,c5m,rs,lvl};
      d._s=sScore(d); results.push(d);
      logTo("sLog",`âœ“ ${t.sym.padEnd(6)} | 5m:${c5m>=0?"+":""}${c5m.toFixed(2)}% | VOL:${vs.toFixed(1)}x | VWAP:${abv?"â–²":"â–¼"} | ${d._s.pts}/${S_MAX}pts`,"lok");
    } catch(e){logTo("sLog",`âœ— ${t.sym} â€” ${e.message}`,"lerr");}
    if(i<total-1) await new Promise(r=>setTimeout(r,400));
  }
  results.sort((a,b)=>b._s.pts!==a._s.pts?b._s.pts-a._s.pts:b.c5m-a.c5m);
  renderScalp(results);
  document.getElementById("s1").textContent=results.length;
  document.getElementById("s2").textContent=results.filter(d=>d.b3).length;
  document.getElementById("s3").textContent=results.filter(d=>d.vs>=1.5).length;
  document.getElementById("s4").textContent=results.filter(d=>d.abv).length;
  document.getElementById("s5").textContent=results.filter(d=>d.ac).length;
  document.getElementById("s6").textContent=results.filter(d=>d._s.pts>=7).length;
  const el=((Date.now()-t0)/1000).toFixed(1);
  document.getElementById("sScanT").textContent=el+"s"; document.getElementById("sScanT").style.color="var(--accent)";
  document.getElementById("sFoot").textContent=`Scanned ${results.length} in ${el}s Â· Top: ${results[0]?.sym||"â€”"} Â· ${new Date().toLocaleTimeString()}`;
  document.getElementById("sDot").style.background="var(--green)"; document.getElementById("sStat").style.color="var(--green)"; document.getElementById("sStat").textContent="DONE";
  document.getElementById("sProg").className="prog-wrap"; document.getElementById("sTime").textContent=new Date().toLocaleTimeString();
  if(results[0]) logTo("sLog",`\nğŸ¯ TOP: ${results[0].sym} â€” ${results[0]._s.pts}/${S_MAX}pts Â· Entry $${results[0].lvl.entry.toFixed(2)} â†’ Target $${results[0].lvl.target.toFixed(2)}`,"linfo");
  for(const x of results.filter(d=>d._s.pts>=7)){
    const l=x.lvl;
    await sendAlert(x.sym,x.name,x.price,x.c5m,x._s.pts,S_MAX,x._s.pts>=10?"SCALP NOW":"STRONG SETUP",x._s.tags.map(t=>t.t).join(" Â· ")+` Â· Entry $${l.entry.toFixed(2)} Target $${l.target.toFixed(2)} Stop $${l.stop.toFixed(2)}`);
    await new Promise(r=>setTimeout(r,300));
  }
  btn.disabled=false; btn.textContent="â–¶ RESCAN";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SWING SCANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const W_MAX=13;
function wScore(d){
  let pts=0; const tags=[];
  if(d.trend.dir==="bull"){pts+=3;tags.push({t:"â–² BULLISH TREND",c:"stg"});}
  else if(d.trend.dir==="bear") tags.push({t:"â–¼ BEARISH",c:"str"});
  if(d.trend.pct>10){pts+=2;tags.push({t:`STRENGTH ${d.trend.pct.toFixed(0)}%`,c:"sty"});}
  if(d.sqPct>70){pts+=2;tags.push({t:`SQUEEZE ${d.sqPct}%`,c:"stp"});}
  else if(d.sqPct>50){pts+=1;tags.push({t:`SQUEEZE ${d.sqPct}%`,c:"stb"});}
  if(d.ema200&&d.price>d.ema200){pts+=2;tags.push({t:"ABOVE EMA200",c:"stg"});}
  else if(d.ema200&&d.price<d.ema200) tags.push({t:"BELOW EMA200",c:"str"});
  if(d.rsi<30){pts+=3;tags.push({t:`RSI ${d.rsi.toFixed(1)} OVERSOLD â˜…`,c:"stg"});}
  else if(d.rsi<=65){pts+=2;tags.push({t:`RSI ${d.rsi.toFixed(1)} BUY ZONE`,c:"sty"});}
  else tags.push({t:`RSI ${d.rsi.toFixed(1)} HIGH`,c:"str"});
  if(d.sma50&&d.price<d.sma50){pts+=1;tags.push({t:"DIP vs SMA50",c:"stb"});}
  return{pts,tags};
}
function wRankColor(i){return i===0?"#f59e0b":i===1?"#94a3b8":i===2?"#b45309":"#1a2535";}
function renderSwingRow(d,rank,s,delay){
  const cc=d.chgPct>=0?"pos":"neg", cs=d.chgPct>=0?"â–²":"â–¼";
  const rCls=d.rsi<30?"oversold":d.rsi>70?"overbought":"neutral";
  const rMf=d.rsi<30?"mfg":d.rsi>70?"mfr":"mfy";
  const e20c=d.ema20?(d.price>=d.ema20?"ema-above":"ema-below"):"";
  const e200c=d.ema200?(d.price>=d.ema200?"ema-above":"ema-below"):"";
  const s50c=d.sma50?(d.price>=d.sma50?"ema-above":"ema-below"):"";
  const tCls=d.trend.dir==="bull"?"num-bull":d.trend.dir==="bear"?"num-bear":"num-dim";
  const tMf=d.trend.dir==="bull"?"mfbull":d.trend.dir==="bear"?"mfbear":"mfd";
  const sqCls=d.sqPct>70?"sq-fire":d.sqPct>40?"sq-warm":"sq-cool";
  const sqMf=d.sqPct>70?"mfp":d.sqPct>40?"mfb":"mfd";
  const sc=s.pts>=9?"#00e5a0":s.pts>=6?"#fbbf24":"#7a9ab8";
  const sig=s.pts>=9?`<span class="signal-main strong">â˜… STRONG BUY</span>`:s.pts>=6?`<span class="signal-main watch">â—ˆ WATCH</span>`:`<span class="signal-main">â—‡ WEAK</span>`;
  const f=v=>v!=null?v.toFixed(2):"â€”";
  return`<tr class="data-row" style="animation-delay:${delay}s">
    <td><div class="rank-cell"><div class="rank-bar" style="background:${wRankColor(rank)}"></div><span class="rank-num ${rank<3?"top3":""}">${rank+1}</span></div></td>
    <td><div class="t-sym">${d.sym}</div><div class="t-name">${d.name}</div></td>
    <td>${sig}<div class="sig-tags">${s.tags.map(t=>`<span class="${t.c}">${t.t}</span>`).join("")}</div></td>
    <td><div class="price-val">$${d.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div><div class="swchg ${cc}">${cs} ${Math.abs(d.chgPct).toFixed(2)}%</div></td>
    <td><div class="rsi-num ${rCls}">${d.rsi!=null?d.rsi.toFixed(1):"â€”"}</div><div class="mini-bar"><div class="mini-fill ${rMf}" style="width:${Math.min(100,d.rsi||0)}%"></div></div></td>
    <td><span class="ema-val ${e20c}">${f(d.ema20)}</span></td>
    <td><span class="ema-val ${e200c}">${f(d.ema200)}</span></td>
    <td><span class="ema-val ${s50c}">${f(d.sma50)}</span></td>
    <td><div class="${tCls}">${d.trend.rawPct!=null?(d.trend.rawPct>=0?"+":"")+d.trend.rawPct.toFixed(2)+"%":"â€”"}</div><div class="mini-bar"><div class="mini-fill ${tMf}" style="width:${d.trend.pct||0}%"></div></div></td>
    <td><div class="${sqCls}">${d.sqPct!=null?d.sqPct+"%":"â€”"}</div><div class="mini-bar"><div class="mini-fill ${sqMf}" style="width:${d.sqPct||0}%"></div></div></td>
    <td><div class="score-cell"><span class="sw-score-num" style="color:${sc}">${s.pts}</span><span class="sw-score-den">/${W_MAX}</span><div class="sw-score-bar"><div class="sw-score-fill" style="width:${(s.pts/W_MAX)*100}%"></div></div></div></td>
  </tr>`;
}
function updateSwingTable(results){
  const sorted=[...results].sort((a,b)=>b._s.pts!==a._s.pts?b._s.pts-a._s.pts:(a.rsi||99)-(b.rsi||99));
  document.getElementById("wBody").innerHTML=sorted.slice(0,10).length
    ?sorted.slice(0,10).map((d,i)=>renderSwingRow(d,i,d._s,i*0.06)).join("")
    :`<tr class="msg-row"><td colspan="11">No results yet...</td></tr>`;
}
async function runSwing(){
  wCache={};
  const btn=document.getElementById("wBtn"); btn.disabled=true; btn.textContent="SCANNING...";
  document.getElementById("wLog").innerHTML=""; document.getElementById("wLog").className="log on";
  await ensureTickersLoaded("wLog");
  document.getElementById("wProg").className="prog-wrap on";
  document.getElementById("wBody").innerHTML=`<tr class="msg-row"><td colspan="11"><span class="spin"></span>SCANNING ALL 100 NDX TICKERS...</td></tr>`;
  const total=TICKERS.length, results=[];  let done=0;
  logTo("wLog",`â–º Scanning all ${total} NDX-100 tickers Â· batches of 5 Â· est. ~60s`,"linfo");
  const BATCH=5;
  for(let i=0;i<total;i+=BATCH){
    const batch=TICKERS.slice(i,i+BATCH);
    const br=await Promise.allSettled(batch.map(t=>yhSwing(t.sym).then(yf=>{
      const{closes,highs,lows,price,chgPct}=yf;
      const sq=squeeze(highs,lows,closes);
      const d={sym:t.sym,name:t.name,price,chgPct,
        rsi:rsi14(closes), ema20:ema(closes,20),
        ema200:closes.length>=200?ema(closes,200):null,
        sma50:sma(closes,50), trend:trendStr(closes),
        sqPct:sq.pct, inSq:sq.inSq};
      d._s=wScore(d); return d;
    })));
    br.forEach((res,j)=>{
      done++; const t=batch[j];
      if(res.status==="fulfilled"){
        const d=res.value; results.push(d);
        logTo("wLog",`âœ“ ${t.sym.padEnd(6)} | $${d.price.toFixed(2).padStart(8)} | RSI:${d.rsi?d.rsi.toFixed(1).padStart(5):"  â€”"} | ${d.trend.dir.toUpperCase().padEnd(4)} | Sq:${d.sqPct!=null?String(d.sqPct+"%").padStart(4):"  â€”"} | ${d._s.pts}/${W_MAX}pts`,"lok");
      } else {
        logTo("wLog",`âœ— ${t.sym} â€” ${res.reason?.message||"failed"}`,"lerr");
      }
    });
    const pct=Math.round((done/total)*100);
    document.getElementById("wPL").textContent=`${done}/${total} scanned`;
    document.getElementById("wPP").textContent=pct+"%"; document.getElementById("wPF").style.width=pct+"%";
    document.getElementById("w1").textContent=results.length;
    document.getElementById("w2").textContent=results.filter(r=>r.trend.dir==="bull").length;
    document.getElementById("w3").textContent=results.filter(r=>r.rsi&&r.rsi>=30&&r.rsi<=65).length;
    document.getElementById("w4").textContent=results.filter(r=>r.sqPct>70).length;
    document.getElementById("w5").textContent=results.filter(r=>r.rsi&&r.rsi<30).length;
    const rv=results.filter(r=>r.rsi!=null);
    document.getElementById("w6").textContent=rv.length?(rv.reduce((a,b)=>a+b.rsi,0)/rv.length).toFixed(1):"â€”";
    updateSwingTable(results);
    if(i+BATCH<total) await new Promise(r=>setTimeout(r,900));
  }
  document.getElementById("wProg").className="prog-wrap";
  btn.disabled=false; btn.textContent="â–¶ RESCAN ALL 100";
  const sorted=[...results].sort((a,b)=>b._s.pts!==a._s.pts?b._s.pts-a._s.pts:(a.rsi||99)-(b.rsi||99));
  document.getElementById("wFoot").textContent=`Scanned ${results.length}/${total} Â· Top: ${sorted[0]?.sym||"â€”"} (${sorted[0]?._s.pts||0}/${W_MAX} pts) Â· ${new Date().toLocaleTimeString()}`;
  if(sorted[0]) logTo("wLog",`\nâ–º TOP: ${sorted[0].sym} â€” ${sorted[0]._s.pts}/${W_MAX}pts Â· RSI ${sorted[0].rsi?.toFixed(1)} Â· ${sorted[0].trend.dir.toUpperCase()}`,"linfo");
}
</script>
</body>
</html>
